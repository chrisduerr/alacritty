language: rust

services:
  - docker

git:
  depth: 1

os:
  - linux
  - osx
  - windows

rust:
  - 1.31.0
  - stable
  - nightly

matrix:
  fast_finish: true
  include:
    - if: tag IS present
      os: linux
      rust: stable
      env: ARCH=i386
    - name: "Clippy Linux"
      os: linux
      env: CLIPPY=true
      rust: stable
    - name: "Clippy OSX"
      os: osx
      env: CLIPPY=true
      rust: stable
    - name: "Clippy Windows"
      os: windows
      env: CLIPPY=true
      rust: stable
    - name: "Rustfmt"
      os: linux
      env: RUSTFMT=true
      rust: nightly
  allow_failures:
    - rust: nightly

install: ci/install.sh
script: ci/script.sh
before_deploy: ci/before_deploy.sh

deploy:
  provider: releases
  api_key:
    secure: TT9mL69wNFfadZIuVw3UernTkrXJDktj0ycTs9EpPEH9y7d+a+aT21LdVVxnoQrgG9vk6YLpPv4ENabwRQNdHWt1RgR/m/qg5tt5AT0v93WENcqi306sFPXILw6P3aPOrzY0Ws/NzjQUa1UBhE5RbXzPnOQp68B32c2C9QxnDeD4ErrxVAUFJRc6V0nDVd0TKTwb8YVshjcpZXf7/3hY4OSByJWFZwns+FdT6l9G8UFDO0eY7ADAl8yO2sKcntY1dL+yDPUHcR9j1aVZ7jHR7ioO2VG0mowjkKKl93Q4huwZu3d3zyzmltbReDZ+Kla6+ympFkW9DpuNWTMDNZH6/E4cd64LgSpFnvEVJ/e4bwdW5Mj/1l/zQPPWGpzberVSi19Zp1R3dQ+2P8b31mKIXM8jHIVlG/0thK1BvBt7Hw6mKNqM2aKjwCEVM2acUPTZMGED/f+5SRwiREb+sM0xvQVZxkVsFiyFtPgL2SRpkp2O8Yc97qUd53x/rN3R0OalWg6XtTKTOmvmw+byfBj/filylXJ8PJUIxsjRLYQ2yknLamKwO+XTeJiosG376LVdP26knYWlVjAOIdN8DRHMAboMa7+6uCamZG8EaEM8Os8ilFJxnza/B4YofRW5loPWE2zBBbocxbwspyGpgMAQRjCunCarDzxbYCuL7+jW02A=
  skip_cleanup: true
  file_glob: true
  file: "./target/deploy/*"
  on:
    tags: true
    rust: stable
    condition: $CLIPPY != true
    repo: chrisduerr/alacritty
