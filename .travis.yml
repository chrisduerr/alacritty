language: rust

sudo: required
services:
  - docker

git:
  depth: 1

os:
  - linux
  - osx
  - windows

rust:
  - stable
  - nightly

matrix:
  fast_finish: true
  include:
    - if: tag IS present
      os: linux
      rust: stable
      env: ARCH=i386
  allow_failures:
    - rust: nightly
    - os: windows

install: ci/install.sh
script: ci/script.sh
before_deploy: ci/before_deploy.sh

deploy:
  provider: releases
  api_key:
    secure: acCPaGRoW9jZWktxyNhAFzD0EOmS+LOoLekBIUUqSZ8KP9eyOmcDi9QaGP7rAGPFR0h1IoD8OTo04GShVmyXfVnEPiw/0vnzrk4z9AxmzpmEgsZec9h45QevLAgrWXmQOXPYnnmluprOCEduMHpbSUOXADZyv25im2S3zEZZI9JhPfE09PzxlJJW/V9Yr7vBjoMNZ6Lj7oKHpsW8pWmh89jG9BYeOTToJjJIPFqXZuNYcFnP6FoMZUgNMZDVbNVvMt3eS922diwd1kOTmFyWkPfIkv6z1hZbca9GjXZU0qACFnxJmyhmHsl1QT1nSkX16224wvrh5+lAO2ZMrcvY/ug8815UbnN5Xp3QF6SL1g32fz+Cbeq+XbK7seVYLlpO9YfHkNArnltfJAyHYYWLnlaRBiRu4x8lynHMH0UFlvQWhjPbzrS7KYdW197aeV6myR+IPl7tl95RVo21yOCNI9CaeuX7O6X9pHv4nwDowZqGf63jGfpKbd2Ze6dTbEWfj6jtP2dFaF7B0r0mDTY/eZAWkUW/S4MRpL1CAK/L69zI1JYqF1ZXExhkYao5p5HrMLZaTfu5JpIkIcCL1i60VBT07WrkH+eC+RkoWzEqPMOTQ1j4Vx4V4H1WAsvgj4YoFW3K/TFrKOYuFm/qPjxU9PgI1MJCMItNVmdRIed9Uxw=
  skip_cleanup: true
  file_glob: true
  file: "./target/deploy/*"
  on:
    tags: true
    rust: stable
