language: rust

services:
  - docker

git:
  depth: 1

os:
  - linux
  - osx
  - windows

rust:
  - stable
  - beta
  - nightly

matrix:
  fast_finish: true
  include:
    - if: tag IS present
      os: linux
      rust: stable
      env: ARCH=i386
    - name: "Clippy Linux"
      os: linux
      env: CLIPPY=true
      rust: stable
    - name: "Clippy OSX"
      os: osx
      env: CLIPPY=true
      rust: stable
    - name: "Clippy Windows"
      os: windows
      env: CLIPPY=true
      rust: stable
  allow_failures:
    - rust: nightly

install: ci/install.sh
script: ci/script.sh
before_deploy: ci/before_deploy.sh

deploy:
  provider: releases
  api_key:
    secure: gWW1pJnuAWwZyT1yW7DHQ30U8eWGhZuZN53pMXdFRLHrDq0+x5t9+3GY2v+baibxBDhYcGb9stnCrDHx8jHtsjeKyvEIEDDjkIOwir/kwLcX1xZHqJxNmnbDY2+No5jIhVozJM/RF0v1QKHD9qGGsKKxsII8O1C1aI2ZhvrvwOfC73SGJN+PVjm1+eEVzrOk6kyceh8Wk+MDfCuQgaY6i3eAeKHublS63+5TgUwz+hZ6/PYdja5XcvT8F3likhis6TWA1YVPIXqEA+Nj03W92uLCzngJv9yC6tXYC9T4KxdCVAHyjdt1rIE7zcJijumagcRFwzgNPsmXL3/CWw+HvXf+c1sXgMNiVZSJPBcBOwPP8uBOGCyvoB/81oOoEJDDfio1tnTaZ1+BiXENo3VDDn4AmPl+CAgQ7ArQs2MMAH4XEAaKrO1NhV7s9Hu1ko/7NVFheH3HacmlVydin6HsRGkJU9pUi53fiYrrWvzelF2ihFAfs7cL4aW3ahYP/Gg/RVc5BekPk8KadlMPsiXT5+OkxzqGcXs24VleQ1biZDB0pOYCSEt2c5xmDnNpkXF3/KMReOuC+hu5ByyJ+TJ+aS8gPblpmwKo8NjlfQmWTwMLopILcUyWnHBjHi+P0sGBpLzX9F0Mvh+0+JJLTkxBiBnU1Rd0ifkiJ8jjIAESXjQ=
  skip_cleanup: true
  file_glob: true
  file: "./target/deploy/*"
  on:
    tags: true
    rust: stable
    condition: $CLIPPY != true
    repo: chrisduerr/alacritty
